<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Morten Kristensen - Unleashing the Power of GDB</title>
  <meta name="author" content="Morten Kristensen" />
  <meta name="description" content="The blog of Morten Kristensen" />
  <link rel="canonical" href="http://nullpointer.dk/2013/02/12/unleashing-the-power-of-gdb/" />

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/favicon.png">
  <link rel="alternate" type="application/atom+xml" title="Morten Kristensen" href="http://nullpointer.dk/atom.xml" />

  <link rel="stylesheet" href="/assets/css/all.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-k2/8zcNbxVIh5mnQ52A0r3a6jAgMGxFJFE2707UxGCk= sha512-ZV9KawG2Legkwp3nAlxLIVFudTauWuBpC10uEafMHYL0Sarrz5A7G79kXh5+5+woxQ5HM559XX2UZjMJ36Wplg==" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
  <h1>Hi.</h1>
  <a href="/">
    
    <img src="http://www.gravatar.com/avatar/77268e36fb81d8421b553f0bccceb69c?s=250" id="gravatar" alt="My photo"/>
    
  </a>
  <h2>I'm <a href="/">Morten Kristensen</a>.</h2>
  <div id="bio">
    <p>C++, Python, Emacs, Clang, CMake, and other technobabble..</p>
  </div>
  <div id="social">
    Follow me:
<div id="stalker">
  
  <a title="netromdk on Github" href="https://github.com/netromdk">
    <i class="fa fa-github-square"></i>
  </a>
  

  

  

  

  
  <a title="Morten Kristensen on Stack Overflow" href="http://stackoverflow.com/users/642148">
    <i class="fa fa-stack-overflow"></i>
  </a>
  

  
  <a title="netromdk on Twitter" href="https://twitter.com/netromdk">
    <i class="fa fa-twitter-square"></i>
  </a>
  

  

  

  
  <a title="Morten Kristensen on LinkedIn" href="https://www.linkedin.com/in/mortenslotkristensen">
    <i class="fa fa-linkedin-square"></i>
  </a>
  

  

  

  
  <a title="Atom feed" id="atom" href="/atom.xml">
    <i class="fa fa-rss-square"></i>
  </a>
  
</div>

  </div>
</nav>

    </div>

    <div class="eleven columns content">
      <p class="meta">
  February 12, 2013 
  <a href="/">
    <i class="home fa fa-home"></i>
  </a>
  <br/>
  Tags:
  
    <a href="/tag/gdb" class="tag">gdb</a>
  
    <a href="/tag/debugging" class="tag">debugging</a>
  
    <a href="/tag/c++" class="tag">c++</a>
  
    <a href="/tag/gcc" class="tag">gcc</a>
  
</p>

<h1 class="title">Unleashing the Power of GDB</h1>

<div id="post">
  <p>The GNU Debugger<a href="http://sourceware.org/gdb/current/onlinedocs/gdb/index.html#Top" target="_blank"><sup>[1]</sup></a> is my favorite debugging tool and I personally think it’s essential for any *nix developer to know how to use it properly if you’re working with C/C++, D, Go, Obj-C, Fortran, Pascal, Modula-2 or Ada<a href="http://sourceware.org/gdb/current/onlinedocs/gdb/Supported-Languages.html#Supported-Languages"><sup>[2]</sup></a>.</p>

<p><em>This is the first in hopefully a series of entries about utilising GDB to its fullest.</em> First a little about how to invoke GDB, secondly some basic usage of some of the most frequently used commands, how to attach to a running program and modify/redirect its <code class="highlighter-rouge">stdout</code> and <code class="highlighter-rouge">stderr</code>, then how to install and use watchpoints, and finally how to manually call functions and class methods.</p>

<h4>Invocation</h4>
<p>Here is how to start debugging a program:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>gdb ./program
</code></pre>
</div>

<p>Make sure to compile your programs with debugging symbols to make source code and line numbers available while debugging. If using GCC or Clang use the <code class="highlighter-rouge">-g</code> argument to do this.</p>

<p>Sometimes arguments have to be passed to the program to debug:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>gdb --args ./program arg1 arg2 arg3..
</code></pre>
</div>

<h4>Basic usage</h4>
<p>The basic commands to use during the debugging phase is <code class="highlighter-rouge">run</code> (<code class="highlighter-rouge">r</code>), <code class="highlighter-rouge">step</code> (<code class="highlighter-rouge">s</code>), <code class="highlighter-rouge">next</code> (<code class="highlighter-rouge">n</code>), <code class="highlighter-rouge">continue</code> (<code class="highlighter-rouge">c</code>), <code class="highlighter-rouge">frame</code> (<code class="highlighter-rouge">f</code>), <code class="highlighter-rouge">backtrace</code> (<code class="highlighter-rouge">bt</code>), <code class="highlighter-rouge">print</code> (<code class="highlighter-rouge">p</code>), <code class="highlighter-rouge">info</code> (<code class="highlighter-rouge">i</code>), <code class="highlighter-rouge">break</code>(<code class="highlighter-rouge">b</code>), <code class="highlighter-rouge">lines</code> (<code class="highlighter-rouge">l</code>), <code class="highlighter-rouge">help</code> (<code class="highlighter-rouge">h</code>) and <code class="highlighter-rouge">quit</code> (<code class="highlighter-rouge">q</code>).</p>

<ul>
	<li><strong>run</strong> will run the program or re-run if already started.</li>
	<li><strong>step</strong> steps until the program reaches a new source code line and can be used with an integer argument to step that many times.</li>
	<li><strong>next</strong> works like `step` except it will treat a function call like a single instruction. Can also be given an integer argument.</li>
	<li><strong>continue</strong> will resume execution after hitting a breakpoint, for instance.</li>
	<li><strong>frame</strong> can be used to select or print current stack frame. When no argument is given it will print the current stack frame, and otherwise it will select the chosen frame.</li>
	<li><strong>backtrace</strong> is used to print a backtrace of all stack frames in order. When an argument is given it will print the innermost frames if positive and the outermost if negative.</li>
	<li><strong>print</strong> prints the value of an expression. It could be variables in the current stack frame, globals or an entire file. As we shall see later on it can also be used to invoke system calls and more.</li>
	<li><strong>info</strong> is very useful because it can display a lot of information about variables, threads, frame, registers, files, types, symbols, locals, addresses and tons more.</li>
	<li><strong>break</strong> is used to set breakpoints in the program at a specified line, function or address.</li>
	<li><strong>lines</strong> with no arguments shows the 10 source code lines centered at the current line. The argument can be a line number, a file with line number (FILE:LINENUM), a function, a file and function (FILE:FUNCTION) or an address (*ADDR).</li>
	<li><strong>help</strong> is invaluable because it explains about more or less everything in GDB. <em>So use it!</em></li>
	<li>Lastly <strong>quit</strong> exits the program and terminates GDB.</li>
</ul>

<p>So let’s give them a spin. Save the following code to a file named “test.cpp”:</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;string&gt;
#include &lt;iostream&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">func2</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"func2 says: "</span> <span class="o">&lt;&lt;</span> <span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">func1</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">string</span> <span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s">"$"</span><span class="p">);</span>
  <span class="n">func2</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">func1</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">5</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Then compile it thusly:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>g++ -g -o <span class="nb">test </span>test.cpp
</code></pre>
</div>

<p>And debug it:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>gdb ./test
</code></pre>
</div>

<p>First thing we will do is set a breakpoint at <code class="highlighter-rouge">main</code> and run the program:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> b main
Breakpoint 1 at 0x100000c4f: file test.cpp, line 15.
<span class="o">(</span>gdb<span class="o">)</span> r
Starting program: /private/tmp/test 
Reading symbols <span class="k">for </span>shared libraries ++............................. <span class="k">done

</span>Breakpoint 1, main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>0x7fff5fbffa80<span class="o">)</span> at test.cpp:15
15	  <span class="k">for</span> <span class="o">(</span>int i <span class="o">=</span> 1; i &lt;<span class="o">=</span> 3; i++<span class="o">)</span> <span class="o">{</span>
<span class="o">(</span>gdb<span class="o">)</span>
</code></pre>
</div>

<p>Then we inspect the arguments of the current stack:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> f
<span class="c">#0  main (argc=1, argv=0x7fff5fbffa80) at test.cpp:15</span>
15	  <span class="k">for</span> <span class="o">(</span>int i <span class="o">=</span> 1; i &lt;<span class="o">=</span> 3; i++<span class="o">)</span> <span class="o">{</span>
<span class="o">(</span>gdb<span class="o">)</span> i args
argc <span class="o">=</span> 1
argv <span class="o">=</span> <span class="o">(</span>char <span class="k">**</span><span class="o">)</span> 0x7fff5fbffa80
<span class="o">(</span>gdb<span class="o">)</span> p argv
<span class="nv">$1</span> <span class="o">=</span> <span class="o">(</span>char <span class="k">**</span><span class="o">)</span> 0x7fff5fbffa80
<span class="o">(</span>gdb<span class="o">)</span> p <span class="k">*</span>argv
<span class="nv">$2</span> <span class="o">=</span> 0x7fff5fbffbf8 <span class="s2">"/private/tmp/test"</span>
<span class="o">(</span>gdb<span class="o">)</span> p argv[0]
<span class="nv">$3</span> <span class="o">=</span> 0x7fff5fbffbf8 <span class="s2">"/private/tmp/test"</span>
<span class="o">(</span>gdb<span class="o">)</span> p argv[1]
<span class="nv">$4</span> <span class="o">=</span> 0x0
<span class="o">(</span>gdb<span class="o">)</span>
</code></pre>
</div>

<p>Notice that the manipulation of the <code class="highlighter-rouge">argv</code> array is very much like in C/C++ with deference/element access (<code class="highlighter-rouge">p *argv</code> and <code class="highlighter-rouge">p argv[1]</code>).</p>

<p>Now we step one round through the <code class="highlighter-rouge">for</code>-loop:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> s
16	    func1<span class="o">(</span>i <span class="k">*</span> 5<span class="o">)</span>;
<span class="o">(</span>gdb<span class="o">)</span> s
func1 <span class="o">(</span><span class="nv">i</span><span class="o">=</span>5<span class="o">)</span> at test.cpp:10
10	  string str<span class="o">(</span>i, <span class="s2">"$"</span><span class="o">)</span>;
<span class="o">(</span>gdb<span class="o">)</span> s
11	  func2<span class="o">(</span>str<span class="o">)</span>;
<span class="o">(</span>gdb<span class="o">)</span> s
func2 <span class="o">(</span><span class="nv">str</span><span class="o">=</span>@0x7fff5fbffa00<span class="o">)</span> at test.cpp:6
6	  cout &lt;&lt; <span class="s2">"func2 says: "</span> <span class="sh">&lt;&lt; str &lt;&lt; endl;
(gdb) s
func2 says: $$$$$
7	}
(gdb) s
func1 (i=5) at test.cpp:12
12	}
(gdb) s
0x0000000100000bee	11	  func2(str);
(gdb) s
main (argc=1, argv=0x7fff5fbffa80) at test.cpp:15
15	  for (int i = 1; i &lt;= 3; i++) {
(gdb)
</span></code></pre>
</div>

<p>What happens is that we first call <code class="highlighter-rouge">func1(5)</code> which in turn calls <code class="highlighter-rouge">func2(str)</code> and returns to the <code class="highlighter-rouge">for</code>-loop. If we instead used <code class="highlighter-rouge">next</code> the output would be shorter because it would not step into <code class="highlighter-rouge">func1</code>:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> n
16	    func1<span class="o">(</span>i <span class="k">*</span> 5<span class="o">)</span>;
<span class="o">(</span>gdb<span class="o">)</span> n
func2 says: <span class="nv">$$$$$$$$$$</span>
15	  <span class="k">for</span> <span class="o">(</span>int i <span class="o">=</span> 1; i &lt;<span class="o">=</span> 3; i++<span class="o">)</span> <span class="o">{</span>
<span class="o">(</span>gdb<span class="o">)</span>
</code></pre>
</div>

<p>It’s time to see a backtrace in action:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> b func2
Breakpoint 2 at 0x100000abc: file test.cpp, line 6.
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.

Breakpoint 2, func2 <span class="o">(</span><span class="nv">str</span><span class="o">=</span>@0x7fff5fbffa00<span class="o">)</span> at test.cpp:6
6	  cout &lt;&lt; <span class="s2">"func2 says: "</span> <span class="sh">&lt;&lt; str &lt;&lt; endl;
(gdb) bt
#0  func2 (str=@0x7fff5fbffa00) at test.cpp:6
#1  0x0000000100000b81 in func1 (i=15) at test.cpp:11
#2  0x0000000100000c65 in main (argc=1, argv=0x7fff5fbffa80) at test.cpp:16
(gdb)
</span></code></pre>
</div>

<p>The trace shows the stack frames in a numbered fashion from <code class="highlighter-rouge">func2</code> and backwards. Let’s inspect frame <code class="highlighter-rouge">#1</code>:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> f 1
<span class="c">#1  0x0000000100000b81 in func1 (i=15) at test.cpp:11</span>
11	  func2<span class="o">(</span>str<span class="o">)</span>;
<span class="o">(</span>gdb<span class="o">)</span> l
6	  cout &lt;&lt; <span class="s2">"func2 says: "</span> <span class="sh">&lt;&lt; str &lt;&lt; endl;
7	}
8	
9	void func1(int i) {
10	  string str(i, "$");
11	  func2(str);
12	}
13	
14	int main(int argc, char **argv) {
15	  for (int i = 1; i &lt;= 3; i++) {
(gdb)
</span></code></pre>
</div>

<p>That concludes the basics:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> q
The program is running.  Exit anyway? <span class="o">(</span>y or n<span class="o">)</span> y
</code></pre>
</div>

<h4>Attaching live programs</h4>
<p>GDB can attach to running programs by stating its process ID (PID):</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>gdb -p PID
</code></pre>
</div>

<p>Here is a little trick to debug a program started by another program at runtime. It might be crucial to attach and debug “from the top” so what to do? Simply add a little sleep to leave enough time to find the PID and attach using GDB. After attaching set the needed breakpoints and <code class="highlighter-rouge">continue</code> execution. Another way of achieving the same thing is to use:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>gdb --waitfor<span class="o">=</span>PROCNAME
</code></pre>
</div>

<p>Where PROCNAME is the process name to continuously poll for until it has been launched. Note that some instructions <em>will</em> have been executed before GDB attaches this way because polling is not exactly instant however close it might seem to be.</p>

<p>A very useful technique is to know how to redirect <code class="highlighter-rouge">stdout</code> (file descriptor 1) and/or <code class="highlighter-rouge">stderr</code> (FD 2) after a program has started. We are going to exploit the fact that <code class="highlighter-rouge">print</code> can invoke system calls like <code class="highlighter-rouge">dup2</code> and <code class="highlighter-rouge">open</code> in our case. After attaching to the process do the following:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> p <span class="o">(</span>void<span class="o">)</span> dup2<span class="o">((</span>int<span class="o">)</span> open<span class="o">(</span><span class="s2">"/tmp/out.txt"</span>, 0x201, 0640<span class="o">)</span>, 1<span class="o">)</span>
<span class="o">(</span>gdb<span class="o">)</span> p <span class="o">(</span>void<span class="o">)</span> dup2<span class="o">((</span>int<span class="o">)</span> open<span class="o">(</span><span class="s2">"/tmp/err.txt"</span>, 0x201, 0640<span class="o">)</span>, 2<span class="o">)</span>
<span class="o">(</span>gdb<span class="o">)</span> detach
<span class="o">(</span>gdb<span class="o">)</span> q
</code></pre>
</div>

<p>In short it will redirect <code class="highlighter-rouge">stdout</code> to “/tmp/stdout.txt” and <code class="highlighter-rouge">stderr</code> to “/tmp/stderr.txt”. The
system call <code class="highlighter-rouge">open</code> is used to open a file for writing in our case. The mode “0x201” actually means
“write only and create file if nonexistent” since <code class="highlighter-rouge">O_CREAT | O_WRONLY</code> = 0x200 | 0x1 = 0x201 (see
the <code class="highlighter-rouge">fcntl.h</code> header file for details). “0640” is the umask (user has RW and group has R). After
opening a file and retrieving its FD we need to redirect the device in question to it (<code class="highlighter-rouge">stdout</code> and
<code class="highlighter-rouge">stderr</code> in this case). This is achieved using <code class="highlighter-rouge">dup2</code> that creates an alias to the FD, does
redirection and closes the old FD.</p>

<p>Additionally, it’s important to cast types to enforce GDB to behave correctly. If this is not the case it could argue giving the following error message:</p>

<p><blockquote>Unable to call function "open" at 0x7fff906e3fe4: no return type information available.
To call this function anyway, you can cast the return type explicitly (e.g. ''print (float) fabs (3.0)'')</blockquote></p>

<p>Another scenario would be to completely turn off output to <code class="highlighter-rouge">stdout</code>/<code class="highlighter-rouge">stderr</code>:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> p <span class="o">(</span>void<span class="o">)</span> close<span class="o">(</span>1<span class="o">)</span>
<span class="o">(</span>gdb<span class="o">)</span> p <span class="o">(</span>void<span class="o">)</span> close<span class="o">(</span>2<span class="o">)</span>
<span class="o">(</span>gdb<span class="o">)</span> det
<span class="o">(</span>gdb<span class="o">)</span> q
</code></pre>
</div>

<p>Here is some code for the testing the above instructions and to observe that the output is redirected or stopped:</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
#include &lt;iostream&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"hello stdout"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"hello stderr"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h4>Watchpoints</h4>
<p>Watchpoints are useful when certain variables need to be watched using the command <code class="highlighter-rouge">watch</code>. Whenever a watched variable is changed GDB will show the old and new value along with the stack frame. Try debugging the program from before:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> b main
Breakpoint 1 at 0x100000c4f: file test.cpp, line 15.
<span class="o">(</span>gdb<span class="o">)</span> r  
Starting program: /private/tmp/test 
Reading symbols <span class="k">for </span>shared libraries ++............................. <span class="k">done

</span>Breakpoint 1, main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>0x7fff5fbffa80<span class="o">)</span> at test.cpp:15
15	  <span class="k">for</span> <span class="o">(</span>int i <span class="o">=</span> 1; i &lt;<span class="o">=</span> 3; i++<span class="o">)</span> <span class="o">{</span>
<span class="o">(</span>gdb<span class="o">)</span> watch i
Hardware watchpoint 2: i
<span class="o">(</span>gdb<span class="o">)</span> d 1
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.
Hardware watchpoint 2: i

Old value <span class="o">=</span> 0
New value <span class="o">=</span> 1
0x0000000100000c56 <span class="k">in </span>main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>0x7fff5fbffa80<span class="o">)</span> at test.cpp:15
15	  <span class="k">for</span> <span class="o">(</span>int i <span class="o">=</span> 1; i &lt;<span class="o">=</span> 3; i++<span class="o">)</span> <span class="o">{</span>
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.
<span class="nv">$$$$</span><span class="err">$</span>
Hardware watchpoint 2: i

Old value <span class="o">=</span> 1
New value <span class="o">=</span> 2
0x0000000100000c6e <span class="k">in </span>main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>0x7fff5fbffa80<span class="o">)</span> at test.cpp:15
15	  <span class="k">for</span> <span class="o">(</span>int i <span class="o">=</span> 1; i &lt;<span class="o">=</span> 3; i++<span class="o">)</span> <span class="o">{</span>
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.
<span class="nv">$$$$$$$$$$</span>
Hardware watchpoint 2: i

Old value <span class="o">=</span> 2
New value <span class="o">=</span> 3
0x0000000100000c6e <span class="k">in </span>main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>0x7fff5fbffa80<span class="o">)</span> at test.cpp:15
15	  <span class="k">for</span> <span class="o">(</span>int i <span class="o">=</span> 1; i &lt;<span class="o">=</span> 3; i++<span class="o">)</span> <span class="o">{</span>
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.
<span class="nv">$$$$$$$$$$$$$$</span><span class="err">$</span>
Hardware watchpoint 2: i

Old value <span class="o">=</span> 3
New value <span class="o">=</span> 4
0x0000000100000c6e <span class="k">in </span>main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>0x7fff5fbffa80<span class="o">)</span> at test.cpp:15
15	  <span class="k">for</span> <span class="o">(</span>int i <span class="o">=</span> 1; i &lt;<span class="o">=</span> 3; i++<span class="o">)</span> <span class="o">{</span>
<span class="o">(</span>gdb<span class="o">)</span> c
Continuing.

Watchpoint 2 deleted because the program has left the block <span class="k">in
</span>which its expression is valid.
</code></pre>
</div>

<p>Notice I did <code class="highlighter-rouge">d 1</code> which means to delete the breakpoint with number “1”.</p>

<h4>Calling functions</h4>
<p>While debugging it is possible to call functions of the program - even pass them arguments - and have the result saved in value history if non-void. Load the first test program from above in GDB:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> b 11
Breakpoint 1 at 0x100000b45: file test.cpp, line 11.
<span class="o">(</span>gdb<span class="o">)</span> r
Starting program: /private/tmp/test 
Reading symbols <span class="k">for </span>shared libraries ++............................. <span class="k">done

</span>Breakpoint 1, func1 <span class="o">(</span><span class="nv">i</span><span class="o">=</span>5<span class="o">)</span> at test.cpp:11
11	  func2<span class="o">(</span>str<span class="o">)</span>;
<span class="o">(</span>gdb<span class="o">)</span> i loc   
str <span class="o">=</span> <span class="o">{</span>
  _M_dataplus <span class="o">=</span> <span class="o">{</span>
    &lt;std::allocator&lt;char&gt;&gt; <span class="o">=</span> <span class="o">{</span>
      &lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; <span class="o">=</span> <span class="o">{</span>&lt;No data fields&gt;<span class="o">}</span>, &lt;No data fields&gt;<span class="o">}</span>, 
    members of std::string::_Alloc_hider: 
    _M_p <span class="o">=</span> 0x100103938 <span class="s2">"</span><span class="nv">$$$$</span><span class="s2">$"</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="o">(</span>gdb<span class="o">)</span> call func2<span class="o">(</span>str<span class="o">)</span>
func2 says: <span class="nv">$$$$</span><span class="err">$</span>
<span class="o">(</span>gdb<span class="o">)</span> q
The program is running.  Exit anyway? <span class="o">(</span>y or n<span class="o">)</span> y
</code></pre>
</div>

<p>Since we already have a <code class="highlighter-rouge">std::string</code> object we can call <code class="highlighter-rouge">func2(str)</code> manually.</p>

<p>This functionality opens up for a variety of different uses. One is to use predefined debugging functions to display custom data structures that GDB doesn’t know about. Take the <code class="highlighter-rouge">std::string</code> structure above for <code class="highlighter-rouge">str</code> - it’s not very descriptive except for the fact that its content is visible (<code class="highlighter-rouge">_M_p = 0x100103938 "$$$$$"</code>).</p>

<p>Compile and load up the following program in GDB:</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;string&gt;
#include &lt;iostream&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Test</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Test</span><span class="p">()</span> <span class="o">:</span> <span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">c</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">str</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

  <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">str</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">dbg</span><span class="p">(</span><span class="k">const</span> <span class="n">Test</span> <span class="o">&amp;</span><span class="n">test</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"a = "</span> <span class="o">&lt;&lt;</span> <span class="n">test</span><span class="p">.</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
       <span class="o">&lt;&lt;</span> <span class="s">"b = "</span> <span class="o">&lt;&lt;</span> <span class="n">test</span><span class="p">.</span><span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
       <span class="o">&lt;&lt;</span> <span class="s">"c = "</span> <span class="o">&lt;&lt;</span> <span class="n">test</span><span class="p">.</span><span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
       <span class="o">&lt;&lt;</span> <span class="s">"str = "</span> <span class="o">&lt;&lt;</span> <span class="n">test</span><span class="p">.</span><span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Test</span> <span class="n">test</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Then it’s high time to compare the two approaches:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> b main
Breakpoint 1 at 0x100000b31: file custom.cpp, line 21.
<span class="o">(</span>gdb<span class="o">)</span> r
Starting program: /private/tmp/custom 
Reading symbols <span class="k">for </span>shared libraries ++............................. <span class="k">done

</span>Breakpoint 1, main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>0x7fff5fbffa78<span class="o">)</span> at custom.cpp:21
21	  Test <span class="nb">test</span>;
<span class="o">(</span>gdb<span class="o">)</span> n
22	  <span class="k">return </span>0;
<span class="o">(</span>gdb<span class="o">)</span> call dbg<span class="o">(</span><span class="nb">test</span><span class="o">)</span>
a <span class="o">=</span> 1
b <span class="o">=</span> 2
c <span class="o">=</span> 3
str <span class="o">=</span> Hello, World!
<span class="o">(</span>gdb<span class="o">)</span> p <span class="nb">test</span>
<span class="nv">$1</span> <span class="o">=</span> <span class="o">{</span>
  a <span class="o">=</span> 1, 
  b <span class="o">=</span> 2, 
  c <span class="o">=</span> 3, 
  str <span class="o">=</span> <span class="o">{</span>
    _M_dataplus <span class="o">=</span> <span class="o">{</span>
      &lt;std::allocator&lt;char&gt;&gt; <span class="o">=</span> <span class="o">{</span>
        &lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; <span class="o">=</span> <span class="o">{</span>&lt;No data fields&gt;<span class="o">}</span>, &lt;No data fields&gt;<span class="o">}</span>, 
      members of std::string::_Alloc_hider: 
      _M_p <span class="o">=</span> 0x100103938 <span class="s2">"Hello, World!"</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="o">(</span>gdb<span class="o">)</span>
</code></pre>
</div>

<p>Keep in mind that this is just a simple test. The great thing about this is that you can fine-tune the debugging function to show only what you need to see and leave out the unnecessary parts. <em>And make sure the variables you’re accessing are actually live and initialised when doing so!</em> If we skip the <code class="highlighter-rouge">next</code> command above this is the result:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> call dbg<span class="o">(</span><span class="nb">test</span><span class="o">)</span>
a <span class="o">=</span> 0
b <span class="o">=</span> 0
c <span class="o">=</span> 0

Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_INVALID_ADDRESS at address: 0xffffffffffffffe8
0x00007fff8fa68c85 <span class="k">in </span>std::operator&lt;&lt; &lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; <span class="o">()</span>
</code></pre>
</div>

<p>It is also possible to call class methods. Add the following snippet after the constructor on line 7 in the previous code:</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">__attribute__</span> <span class="p">((</span><span class="n">used</span><span class="p">))</span> <span class="n">dump</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"str = "</span> <span class="o">&lt;&lt;</span> <span class="n">str</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Notice the use of the “used” attribute - this is because if the method is not called in the source code, which is the case here, the compiler will optimise the whole thing away in most cases.</p>

<p>Invoking the method on our <code class="highlighter-rouge">test</code> object is easy:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> call test.dump<span class="o">()</span>
str <span class="o">=</span> Hello, World!
</code></pre>
</div>

<p>That concludes the basic knowledge needed to start debugging using GDB. Stay tuned for more!</p>

</div>

<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
    <li>
      <span>29 Aug 2016 &raquo;</span> <a href="/2016/08/29/rewamped-for-github/">Rewamped for GitHub</a>
    </li>
    
    <li>
      <span>06 Mar 2013 &raquo;</span> <a href="/2013/03/06/proper-multithreading-with-qt/">Proper multithreading with Qt</a>
    </li>
    
    <li>
      <span>03 Mar 2013 &raquo;</span> <a href="/2013/03/03/unleashing-the-power-of-gdb-part2/">Unleashing the Power of GDB (part 2)</a>
    </li>
    
  </ul>
</div>


      <div class="footer">
        <div class="disclaimer">
  

  <p>
    © Morten Kristensen, 2016
  </p>
</div>

      </div>
    </div>
  </div>


</body>
</html>
